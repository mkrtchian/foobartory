(this.webpackJsonpfoobartory=this.webpackJsonpfoobartory||[]).push([[0],{22:function(t,e,o){"use strict";o.r(e);var i,n=o(2),a=o.n(n),s=o(14),r=o.n(s),c=function(t){t&&t instanceof Function&&o.e(3).then(o.bind(null,23)).then((function(e){var o=e.getCLS,i=e.getFID,n=e.getFCP,a=e.getLCP,s=e.getTTFB;o(t),i(t),n(t),a(t),s(t)}))},u=o(1),h=o(3),b=function(){function t(){Object(u.a)(this,t)}return Object(h.a)(t,[{key:"getCurrentTime",value:function(){return Date.now()}}]),t}(),l=o(9);!function(t){t.MOVING="moving",t.MINING_FOO="mining foo",t.MINING_BAR="mining bar",t.ASSEMBLING="assembling",t.BUYING_ROBOT="buying robot",t.WAITING="waiting"}(i||(i={}));var v,O={actionType:i.MOVING,totalDuration:5e3},f={actionType:i.MINING_FOO,totalDuration:1e3},m={actionType:i.MINING_BAR,randomBetween:[500,2e3]},A={actionType:i.ASSEMBLING,totalDuration:2e3},d={actionType:i.BUYING_ROBOT,totalDuration:0},g={actionType:i.WAITING,totalDuration:0},y={foos:1,bars:1,foobars:0},k={foos:6,bars:0,foobars:3},T=o(7),_=o(10),j=function(){function t(){Object(u.a)(this,t),this.callbacks=void 0,this.callbacks=new Map}return Object(h.a)(t,[{key:"subscribe",value:function(t,e){var o;null===(o=this.callbacks.get(t))||void 0===o||o.push(e)}},{key:"trigger",value:function(t,e){var o=this.callbacks.get(t);o&&o.forEach((function(t){t(e)}))}}]),t}();!function(t){t[t.ROBOT_LOCATION=0]="ROBOT_LOCATION"}(v||(v={}));var N,B=function(t){Object(T.a)(o,t);var e=Object(_.a)(o);function o(){var t;return Object(u.a)(this,o),(t=e.call(this)).callbacks.set(v.ROBOT_LOCATION,[]),t}return o}(j);!function(t){t[t.FOOS_AMOUNT=0]="FOOS_AMOUNT",t[t.BARS_AMOUNT=1]="BARS_AMOUNT",t[t.FOOBARS_AMOUNT=2]="FOOBARS_AMOUNT",t[t.ROBOTS_AMOUNT=3]="ROBOTS_AMOUNT"}(N||(N={}));var w,M=function(t){Object(T.a)(o,t);var e=Object(_.a)(o);function o(){var t;return Object(u.a)(this,o),(t=e.call(this)).callbacks.set(N.FOOS_AMOUNT,[]),t.callbacks.set(N.BARS_AMOUNT,[]),t.callbacks.set(N.FOOBARS_AMOUNT,[]),t.callbacks.set(N.ROBOTS_AMOUNT,[]),t}return o}(j),R=o(11),S=o(15),L=function(){function t(){Object(u.a)(this,t)}return Object(h.a)(t,[{key:"randomPercentageSuccess",value:function(t){if(t<0||t>100)throw new Error("The given percentage has to be between 0 and 100, not ".concat(t,"."));return 100*Math.random()<t}},{key:"randomBetweenTwoValues",value:function(t,e){return t+Math.random()*(e-t)}},{key:"chooseValue",value:function(t){this._checkWeights(t);var e,o=Array.from(t.values()).reduce((function(t,e){return t+e})),i=Math.random()*o,n=t.entries().next().value,a=0,s=Object(S.a)(t);try{for(s.s();!(e=s.n()).done;){var r=Object(R.a)(e.value,2),c=r[0];if(i<=(a+=r[1])){n=c;break}}}catch(u){s.e(u)}finally{s.f()}return n}},{key:"_checkWeights",value:function(t){var e=Array.from(t.values());if(e.some((function(t){return t<0}))){var o=Array.from(t.entries());throw new Error("Negative weights are not allowed. Entries: ".concat(o))}if(e.every((function(t){return 0===t}))){var i=Array.from(t.entries());throw new Error("At least one of the weights has to be > 0. Entries: ".concat(i))}}}]),t}();!function(t){t.FOO_MINE="foo mine",t.BAR_MINE="bar mine",t.ASSEMBLING_FACTORY="assembling factory",t.SHOP="shop",t.TRANSITION="transition"}(w||(w={}));var F=function(){function t(e,o){Object(u.a)(this,t),this.store=e,this.location=void 0,this.action=void 0,this.randomGenerator=void 0,this.nextLocation=void 0,this.actionStartTime=void 0,this.keepLocation=void 0,this.observable=void 0,this.nextLocation=null,this.keepLocation=!1,this.action=g,this.actionStartTime=null,this.observable=e.getRobotsObservable(),this.store.addRobot(this),this.location=w.SHOP,this.setLocation((null===o||void 0===o?void 0:o.initialLocation)?o.initialLocation:w.SHOP),this.randomGenerator=(null===o||void 0===o?void 0:o.randomGenerator)?null===o||void 0===o?void 0:o.randomGenerator:new L}return Object(h.a)(t,[{key:"tick",value:function(t){if(null!==this.actionStartTime){var e,o,i=t-this.actionStartTime;if("randomBetween"in this.action)e=(o=this.randomGenerator).randomBetweenTwoValues.apply(o,Object(l.a)(this.action.randomBetween));else e=this.action.totalDuration;i>=e&&this._endAction()}}},{key:"_endAction",value:function(){switch(this.action.actionType){case O.actionType:if(!this.nextLocation)throw new Error("The robot can't end its move without a location specified.");this._moveTo(this.nextLocation);break;case f.actionType:this._mineFoo();break;case m.actionType:this._mineBar();break;case A.actionType:this._assemble();break;case d.actionType:this._buyRobot();break;default:throw new Error("There is a start time defined for an action, but the action of the robot is incorrect (".concat(this.action.actionType,")."))}this.action=g,this.actionStartTime=null}},{key:"_moveTo",value:function(t){this.setLocation(t),this.nextLocation=null}},{key:"_mineFoo",value:function(){this.store.setFoosAmount(this.store.getFoosAmount()+1)}},{key:"_mineBar",value:function(){this.store.setBarsAmount(this.store.getBarsAmount()+1)}},{key:"_assemble",value:function(){this.randomGenerator.randomPercentageSuccess(60)?this.store.setFoobarsAmount(this.store.getFoobarsAmount()+1):this.store.setBarsAmount(this.store.getBarsAmount()+1)}},{key:"_buyRobot",value:function(){new t(this.store)}},{key:"startMoving",value:function(t){this.checkAvailable(),this._checkLocationSpecified(),this._checkNotKeepingLocation(),this.setLocation(w.TRANSITION),this.action=O,this.actionStartTime=t}},{key:"startMining",value:function(t){if(this.checkAvailable(),this.location===w.FOO_MINE)this.action=f;else{if(this.location!==w.BAR_MINE)throw new Error("The robot has to be in a mine to mine, here it is in ".concat(this.location,"."));this.action=m}this.actionStartTime=t}},{key:"startAssembling",value:function(t){this.checkAvailable(),this._checkLocation(w.ASSEMBLING_FACTORY),this._checkRessources("To create a foobar the robot needs one foo and one bar",y),this.action=A,this.actionStartTime=t,this.store.setBarsAmount(this.store.getBarsAmount()-1),this.store.setFoosAmount(this.store.getFoosAmount()-1)}},{key:"startBuyingRobot",value:function(t){this.checkAvailable(),this._checkLocation(w.SHOP),this._checkRessources("To buy a new robot, the robot needs 6 foos and 3 foobars",k),this.action=d,this.actionStartTime=t,this.store.setFoobarsAmount(this.store.getFoobarsAmount()-3),this.store.setFoosAmount(this.store.getFoosAmount()-6)}},{key:"_checkLocation",value:function(t){if(t!==this.location)throw new Error("The robot has to be in the ".concat(t,", here it is in ").concat(this.location,"."))}},{key:"_checkLocationSpecified",value:function(){if(!this.getNextLocation())throw new Error("The robot can't start moving without next location specified.")}},{key:"_checkNotKeepingLocation",value:function(){if(this.getKeepLocation())throw new Error("The robot can't start moving while it has been asked to keep its location.")}},{key:"_checkRessources",value:function(t,e){if(!(this.store.getFoobarsAmount()>=e.foobars&&this.store.getFoosAmount()>=e.foos&&this.store.getBarsAmount()>=e.bars))throw new Error("".concat(t,".\n        There are only ").concat(this.store.getFoosAmount()," foos, ").concat(this.store.getBarsAmount()," bars and ").concat(this.store.getFoobarsAmount()," foobars."))}},{key:"checkAvailable",value:function(){if(!this.isAvailable())throw new Error("The robot is not available yet")}},{key:"canAssemble",value:function(){return this._canDoAction(y)}},{key:"canBuyRobot",value:function(){return this._canDoAction(k)}},{key:"_canDoAction",value:function(t){try{this._checkRessources("",t)}catch(e){return!1}return!0}},{key:"isAvailable",value:function(){return this.action===g}},{key:"subscribe",value:function(t,e){this.observable.subscribe(t,e)}},{key:"setNextLocation",value:function(t){this.nextLocation=t}},{key:"getNextLocation",value:function(){return this.nextLocation}},{key:"getLocation",value:function(){return this.location}},{key:"setLocation",value:function(t){this.location=t;var e=[];this.store.getRobots().forEach((function(t){e.push(t.getLocation())})),this.observable.trigger(v.ROBOT_LOCATION,e)}},{key:"getAction",value:function(){return this.action}},{key:"setKeepLocation",value:function(t){this.keepLocation=t}},{key:"getKeepLocation",value:function(){return this.keepLocation}}]),t}(),I=function(){function t(){Object(u.a)(this,t),this.foosAmount=void 0,this.barsAmount=void 0,this.fooBarsAmount=void 0,this.robots=void 0,this.observable=void 0,this.robotsObservable=void 0,this.observable=new M,this.robotsObservable=new B,this.foosAmount=0,this.barsAmount=0,this.fooBarsAmount=0,this.robots=[]}return Object(h.a)(t,[{key:"subscribe",value:function(t,e){this.observable.subscribe(t,e)}},{key:"subscribeToRobots",value:function(t,e){this.robotsObservable.subscribe(t,e)}},{key:"setFoosAmount",value:function(t){this.foosAmount=t,this.observable.trigger(N.FOOS_AMOUNT,this.foosAmount)}},{key:"getFoosAmount",value:function(){return this.foosAmount}},{key:"setBarsAmount",value:function(t){this.barsAmount=t,this.observable.trigger(N.BARS_AMOUNT,this.barsAmount)}},{key:"getBarsAmount",value:function(){return this.barsAmount}},{key:"setFoobarsAmount",value:function(t){this.fooBarsAmount=t,this.observable.trigger(N.FOOBARS_AMOUNT,this.fooBarsAmount)}},{key:"getFoobarsAmount",value:function(){return this.fooBarsAmount}},{key:"addRobot",value:function(t){this.robots.push(t),this.observable.trigger(N.ROBOTS_AMOUNT,this.robots.length)}},{key:"getRobots",value:function(){return this.robots}},{key:"getRobotsObservable",value:function(){return this.robotsObservable}}]),t}(),p=function(){function t(e){Object(u.a)(this,t),this.randomGenerator=void 0,this.automaticMovementProbability=void 0,this.automaticLocationProbabilities=void 0,this.randomGenerator=(null===e||void 0===e?void 0:e.randomGenerator)?e.randomGenerator:new L,this.automaticMovementProbability=50,this.automaticLocationProbabilities=new Map([[w.FOO_MINE,5],[w.BAR_MINE,5],[w.ASSEMBLING_FACTORY,5],[w.SHOP,5]])}return Object(h.a)(t,[{key:"setLocationWeight",value:function(t,e){if(e<0)throw new Error("The assigned weight ".concat(e," has to be greater than 0."));this.automaticLocationProbabilities.set(t,e)}},{key:"setAutomaticMovementProbability",value:function(t){this.automaticMovementProbability=t}},{key:"actOnOneFrame",value:function(t,e){var o=this;e.getRobots().forEach((function(e){(e.tick(t),e.isAvailable())&&(e.getNextLocation()&&!e.getKeepLocation()?e.startMoving(t):o._handleAutomaticActions(e,t))}))}},{key:"_handleAutomaticActions",value:function(t,e){this.randomGenerator.randomPercentageSuccess(this.automaticMovementProbability)&&!t.getKeepLocation()?this._doAutomaticMove(t,e):this._doAutomaticOtherActions(t,e)}},{key:"_doAutomaticMove",value:function(t,e){var o=new Map(this.automaticLocationProbabilities);o.delete(t.getLocation());try{var i=this.randomGenerator.chooseValue(o);t.setNextLocation(i),t.startMoving(e)}catch(n){if(!n.message.includes("At least one of the weights has to be > 0"))throw n}}},{key:"_doAutomaticOtherActions",value:function(t,e){switch(t.getLocation()){case w.FOO_MINE:case w.BAR_MINE:t.startMining(e);break;case w.ASSEMBLING_FACTORY:t.canAssemble()&&t.startAssembling(e);break;case w.SHOP:t.canBuyRobot()&&t.startBuyingRobot(e);break;default:throw new Error("An action has been requested while the robot was the wrong location (".concat(t.getLocation(),")."))}}}]),t}(),E=function(){function t(e,o){Object(u.a)(this,t),this.store=void 0,this.dateTime=void 0,this.strategy=void 0,this.started=void 0,this.store=new I,this.dateTime=(null===o||void 0===o?void 0:o.dateTime)?o.dateTime:new b,this.strategy=e||new p,new F(this.store),new F(this.store),this.started=!1}return Object(h.a)(t,[{key:"start",value:function(){var t=this;this.started=!0;var e=0;!function o(){var i=t.dateTime.getCurrentTime();t.strategy.actOnOneFrame(i,t.store),t.store.getRobots().length<20?e=requestAnimationFrame(o):(cancelAnimationFrame(e),t.started=!1)}()}},{key:"setRobotNextLocation",value:function(t,e){this.store.getRobots()[t].setNextLocation(e)}},{key:"getRobotLocation",value:function(t){return this.store.getRobots()[t].getLocation()}},{key:"getStrategy",value:function(){return this.strategy}},{key:"getStarted",value:function(){return this.started}},{key:"subscribeToAmount",value:function(t,e){this.store.subscribe(t,e)}},{key:"subscribeToRobots",value:function(t,e){this.store.subscribeToRobots(t,e)}}]),t}(),x=a.a.createContext(new E(new p));function G(t){var e=t.game,o=t.initialValue,i=t.observed,a=Object(n.useState)(o),s=Object(R.a)(a,2),r=s[0],c=s[1];return Object(n.useEffect)((function(){e.subscribeToAmount(i,c)}),[e,i]),r}var P=o(16),U=function(t){Object(T.a)(o,t);var e=Object(_.a)(o);function o(){return Object(u.a)(this,o),e.apply(this,arguments)}return Object(h.a)(o,[{key:"increment",value:function(t){this.has(t)&&this.set(t,this.get(t)+1)}},{key:"decrement",value:function(t){this.has(t)&&this.set(t,this.get(t)-1)}}]),o}(Object(P.a)(Map));function C(t){var e=function(t){var e=t.game,o=t.initialValue,i=t.observed,a=Object(n.useState)(o),s=Object(R.a)(a,2),r=s[0],c=s[1];return Object(n.useEffect)((function(){e.subscribeToRobots(i,c)}),[e,i]),r}({game:t,initialValue:[],observed:v.ROBOT_LOCATION});return Object(n.useMemo)((function(){var t=new U([[w.FOO_MINE,0],[w.BAR_MINE,0],[w.ASSEMBLING_FACTORY,0],[w.SHOP,0],[w.TRANSITION,0]]);return e.forEach((function(e){t.increment(e)})),t}),[e])}var V=o(0);var D=function(){var t=C(Object(n.useContext)(x));return Object(V.jsxs)("ul",{children:[Object(V.jsxs)("li",{children:["Foo mine: ",t.get(w.FOO_MINE)]}),Object(V.jsxs)("li",{children:["Bar mine: ",t.get(w.BAR_MINE)]}),Object(V.jsxs)("li",{children:["Assembling factory:"," ",t.get(w.ASSEMBLING_FACTORY)]}),Object(V.jsxs)("li",{children:["Shop: ",t.get(w.SHOP)]}),Object(V.jsxs)("li",{children:["Moving: ",t.get(w.TRANSITION)]})]})};var H=function(){var t=Object(n.useContext)(x),e=G({game:t,initialValue:t.store.getFoosAmount(),observed:N.FOOS_AMOUNT}),o=G({game:t,initialValue:t.store.getBarsAmount(),observed:N.BARS_AMOUNT}),i=G({game:t,initialValue:t.store.getFoobarsAmount(),observed:N.FOOBARS_AMOUNT}),a=G({game:t,initialValue:t.store.getRobots().length,observed:N.ROBOTS_AMOUNT});return Object(V.jsxs)("ul",{children:[Object(V.jsxs)("li",{children:["Foos: ",Object(V.jsx)("span",{children:e})]}),Object(V.jsxs)("li",{children:["Bars: ",Object(V.jsx)("span",{children:o})]}),Object(V.jsxs)("li",{children:["Foobars: ",Object(V.jsx)("span",{children:i})]}),Object(V.jsxs)("li",{children:["Robots: ",Object(V.jsx)("span",{children:a})]})]})};var Y=function(){var t=Object(n.useRef)(new E(new p));return Object(n.useEffect)((function(){t.current.start();var e=t.current.getStrategy();e.setLocationWeight(w.FOO_MINE,10),e.setLocationWeight(w.BAR_MINE,3),e.setAutomaticMovementProbability(25)}),[]),Object(V.jsx)(x.Provider,{value:t.current,children:Object(V.jsxs)("main",{role:"main",children:[Object(V.jsx)(H,{}),Object(V.jsx)(D,{})]})})};r.a.render(Object(V.jsx)(a.a.StrictMode,{children:Object(V.jsx)(Y,{})}),document.getElementById("root")),c()}},[[22,1,2]]]);
//# sourceMappingURL=main.10107a9c.chunk.js.map